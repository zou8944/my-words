## 2025-06-12

å°† Emoji å†™å…¥ä¸€ä¸ªå›¾ç‰‡çš„æŒ‡å®šä½ç½®å¹¶ä¸å®¹æ˜“ï¼Œä»Šå¤©æŠ˜è…¾äº†ä¸€ä¸ªå¤šå°æ—¶æ‰æå®šã€‚ä¸»è¦æ˜¯ `PIL` ä¸ç›´æ¥æ”¯æŒï¼Œ`Imagemagick` é»˜è®¤çš„ç‰ˆæœ¬ä¹Ÿä¸æ”¯æŒã€‚æ‰¾æ¥æ‰¾å»å‘ç°äº†`pilmoji`ï¼Œä½†å®ƒåœ¨å¤„ç†æ–‡å­—å’Œ emoji æ··åˆæ–‡æœ¬æ—¶åœ¨ç›®æ ‡å›¾ç‰‡å†…å¯¹é½åˆæ˜¯ä¸ªé—®é¢˜ã€‚äºæ˜¯ä½¿ç”¨ `pilmoji` å…ˆå°†æ–‡æœ¬è½¬æ¢ä¸ºå›¾ç‰‡ï¼Œå†å°†å›¾ç‰‡è´´åˆ°ç›®æ ‡å›¾ç‰‡ã€‚ä»£ç å¦‚ä¸‹ã€‚

```python
from PIL import Image, ImageFont
from pilmoji import Pilmoji
from pilmoji.source import AppleEmojiSource


def create_text_image(text, font, text_color=(0, 0, 0)):
    """ä½¿ç”¨pilmojiåˆ›å»ºåŒ…å«emojiçš„æ–‡å­—å›¾ç‰‡ï¼ˆé€æ˜èƒŒæ™¯ï¼‰"""
    # åˆ›å»ºä¸€ä¸ªè¶³å¤Ÿå¤§çš„ä¸´æ—¶å›¾ç‰‡æ¥æµ‹é‡æ–‡æœ¬å°ºå¯¸
    temp_img = Image.new('RGBA', (1000, 200), (255, 255, 255, 0))
    
    with Pilmoji(temp_img, source=AppleEmojiSource) as pilmoji:
        # æ¸²æŸ“æ–‡æœ¬åˆ°ä¸´æ—¶å›¾ç‰‡
        pilmoji.text((10, 10), text, text_color, font, 
                     emoji_scale_factor=1.15, emoji_position_offset=(0, 0))
    
    # è·å–æ–‡æœ¬çš„å®é™…è¾¹ç•Œæ¡†
    bbox = temp_img.getbbox()
    if bbox is None:
        # å¦‚æœæ²¡æœ‰å†…å®¹ï¼Œè¿”å›ç©ºå›¾ç‰‡
        return Image.new('RGBA', (1, 1), (255, 255, 255, 0))
    
    # è£å‰ªåˆ°å®é™…æ–‡æœ¬å¤§å°
    text_img = temp_img.crop(bbox)
    
    return text_img


def add_text_to_image(image_path, output_path, text):
    # æ‰“å¼€èƒŒæ™¯å›¾ç‰‡
    background = Image.open(image_path)
    
    # åŠ è½½å­—ä½“
    font = ImageFont.truetype('MiSans-Medium.ttf', 70)
    
    # åˆ›å»ºæ–‡å­—å›¾ç‰‡
    text_img = create_text_image(text, font, (0, 0, 0))
    
    # è®¡ç®—æ–‡å­—å›¾ç‰‡åœ¨èƒŒæ™¯å›¾ç‰‡ä¸­çš„å±…ä¸­ä½ç½®
    bg_width, bg_height = background.size
    text_width, text_height = text_img.size
    
    x = (bg_width - text_width) // 2
    y = (bg_height - text_height) // 2 - 60  # å‘ä¸Šåç§»60åƒç´ 

    # å°†æ–‡å­—å›¾ç‰‡ç²˜è´´åˆ°èƒŒæ™¯å›¾ç‰‡ä¸Š
    background.paste(text_img, (x, y), text_img)
    
    final_image = background
    final_image.save(output_path)
    print(f"Image saved with emoji support: {output_path}")


def main():
    cert_base_dir = "cert"
    cert_template_path = "/Users/zouguodong/Downloads/deltaè¯ä¹¦.png"
    csv_file = "/Users/zouguodong/Downloads/delta-member.csv"
    with open(csv_file, 'r') as file:
        lines = file.readlines()
        for line in lines[1:]:
            id, name, phone = line.strip().split(',')
            # if "aac" in name:
            print(f"Processing {name} with ID {id} and phone {phone}")
            cert_out_path = f"{cert_base_dir}/{id}.png"
            add_text_to_image(cert_template_path, cert_out_path, name)

if __name__ == '__main__':
    cert_template_path = "/Users/zouguodong/Downloads/deltaè¯ä¹¦.png"
    cert_out_path = "~/Downloads/result.png"
    name = "æ€è€ƒğŸ¤”"
    add_text_to_image(cert_template_path, cert_out_path, name)

```

