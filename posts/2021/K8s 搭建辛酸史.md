---
created_at: 2021-12-18 16:03:49
updated_at: 2021-12-18 16:03:49
slug: kubernetes-build-process
---

æˆ‘æœ‰ä¸€ä¸ªæ ‘è“æ´¾3Bï¼Œ1Gå†…å­˜ç‰ˆæœ¬ï¼Œä»¥å‰ç”¨æ¥å½“åšlinuxä¸»æœºï¼Œéšä¾¿ç©ä¸€ç©ï¼Œè°¢è°¢pythonï¼Œç‚¹ä¸ªç¯ã€‚ä½†æœ€è¿‘æˆ‘æƒ³æ­å»ºä¸€ä¸ªKubernetesé›†ç¾¤ï¼Œç”¨æ¥å­¦ä¹ ï¼Œä¸è¿‡é›†ç¾¤è¯¶ï¼Œæ€ä¹ˆèƒ½åªæœ‰ä¸€å°æœºå™¨å‘¢ï¼Ÿäºæ˜¯åœ¨å’¸é±¼ä¸Šåˆè´­ä¹°äº†ä¸¤å°æ ‘è“æ´¾4Bï¼Œä¸€å°4GBå†…å­˜ï¼Œä¸€å°2GBå†…å­˜ã€‚ä¸ºä»€ä¹ˆæƒ³ç”¨æ ‘è“æ´¾å‘¢ï¼Ÿä¸€æ¥å› ä¸ºè¿˜ç®—OKçš„äº‘æœåŠ¡å™¨è´µå¾—ç¦»è°±ï¼Œå¯¹ä¸ªäººæ¥è¯´å®åœ¨ä¸åˆ’ç®—ï¼ŒäºŒæ¥æ ‘è“æ´¾å¯ç©æ€§æ¯”è¾ƒé«˜ã€‚

ç„¶è€Œæ­å»ºè¿‡ç¨‹å‡ ç»æ³¢æŠ˜ï¼Œæµªè´¹äº†å¤§é‡çš„æ—¶é—´ï¼Œæƒ³æ¥ï¼Œæœ€ä¸»è¦çš„é—®é¢˜æœ‰ä¸¤ä¸ªï¼šcgroupçš„å¼€å¯å¤±è´¥å’Œå¢™çš„é—®é¢˜ã€‚

<!-- more -->

## ç³»ç»Ÿé€‰æ‹©

ä¸ºå°½é‡æ»¡è¶³åº”ç”¨çš„å…¼å®¹æ€§ï¼Œé€‰æ‹©64ä½æ“ä½œç³»ç»Ÿï¼›åˆè‡ªå·±å¯¹Ubuntuç³»æ“ä½œç³»ç»Ÿæ¯”è¾ƒç†Ÿï¼Œäºæ˜¯é€‰æ‹©Ubuntu 20.04LTS Serverç‰ˆã€‚ä¸ºæ­¤ï¼Œåˆ°Ubuntuå®˜ç½‘ä¸‹è½½é•œåƒï¼Œé€šè¿‡æ ‘è“æ´¾å®˜æ–¹çš„Raspberry Pi Imageråˆ¶ä½œTFå¡ç³»ç»Ÿç›˜ã€‚éœ€è¦ä¸¥æ ¼æŒ‰ç…§[å®˜æ–¹æ•™ç¨‹](https://ubuntu.com/tutorials/how-to-install-ubuntu-on-your-raspberry-pi#4-boot-ubuntu-server)æ¥ï¼Œéœ€è¦æ³¨æ„å‡ ä¸ªé—®é¢˜

- å¦‚æœç›´æ¥ç½‘çº¿è¿æ¥è·¯ç”±å™¨ï¼Œåˆ™ç½‘ç»œé…ç½®ä¸éœ€è¦
- å¦‚æœéœ€è¦å¼€æœºè‡ªåŠ¨è¿æ¥wifiï¼Œåˆ™éœ€è¦ä¿®æ”¹ç³»ç»Ÿç›˜æ ¹ç›®å½•ä¸‹network-configæ–‡ä»¶ï¼Œåœ¨æ’å…¥æ ‘è“æ´¾ä¹‹å‰ç”¨è¯»å¡å™¨ä¿®æ”¹
- é»˜è®¤è´¦å·ubuntuï¼Œé»˜è®¤å¯†ç ubuntu
- å¼€æœºç¬¬ä¸€æ¬¡ç™»å½•ä¼šå¼ºåˆ¶è¦æ±‚ä¿®æ”¹å¯†ç ï¼Œåˆ°æ—¶å€™æ³¨æ„ä¿®æ”¹
- MacBook Pro m1ç‰ˆèƒ½å¤Ÿå®Œç¾è¿è¡ŒRaspberry Pi Imager

## æ­å»ºè¿‡ç¨‹

ç›®å‰å¸‚åœºä¸Šæœ‰å¸¸è§„k8sã€ubuntuçš„microk8sã€rancherçš„k3så¯ä¾›é€‰æ‹©ï¼Œæœ€ä»¤äººåŠ¨å¿ƒçš„è¿˜æ˜¯microk8sï¼Œå…¶åŠŸèƒ½é½å…¨ï¼Œè¿˜ç›¸å¯¹è½»é‡ï¼Œéå¸¸é€‚åˆå­¦ä¹ ï¼Œè€Œk3såˆ™é˜‰å‰²æ›¿æ¢äº†å¾ˆå¤šä¸œè¥¿ã€‚

### æ­å»ºmicrok8s

å‚è€ƒ[å®˜æ–¹æ‰‹å†Œ](https://ubuntu.com/tutorials/how-to-kubernetes-cluster-on-raspberry-pi?&_ga=2.152469631.732019699.1639280743-1880426195.1638801725#1-overview)ï¼Œå…³é”®ç‚¹æœ‰ä»¥ä¸‹å‡ æ­¥ï¼š

1. å¼€å¯cgroupï¼Œåœ¨`/boot/firmware/cmdline.txt`æ–‡ä»¶æ·»åŠ `cgroup_enable=memory cgroup_memory=1`ç„¶åé‡å¯
2. ç›´æ¥snapå®‰è£…ï¼š`sudo snap install microk8s --classic`

é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘çš„ä¸‰å°æœºå™¨ï¼ŒæŒ‰ç…§è¿™ç§æ–¹å¼ï¼Œæ­»æ´»æ— æ³•å¼€å¯cgroupï¼Œmicrok8sè‡ªç„¶ä¹Ÿæ— æ³•æ­£å¸¸å·¥ä½œï¼Œç½‘ä¸Šçš„èµ„æ–™ï¼Œéƒ½æŒ‡å‘ä¸€ä¸ªé—®é¢˜

- æ ¹æ®ç³»ç»Ÿçš„ç‰ˆæœ¬ï¼Œå¼€å¯cgroupé…ç½®çš„æ–¹å¼å¯èƒ½ä¸åœ¨`/boot/firmware/cmdline.txt`ä¸­ã€‚ä½†æˆ‘ç¡®è®¤ubuntu 20.04å°±æ˜¯åœ¨è¿™ä¸ªæ–‡ä»¶

æœ‰çš„äººç¡®å®æ˜¯è¿™ä¸ªé—®é¢˜ï¼Œæœ‰çš„äººå´ä¸æ˜¯ï¼Œé‚£äº›ä¸æ˜¯çš„ï¼Œæœ€ç»ˆä¹Ÿæ²¡æœ‰å¾—åˆ°æ˜ç¡®çš„è§£å†³æ–¹æ¡ˆã€‚

äºæ˜¯ï¼Œæˆ‘è¢«å¡ä½äº†ï¼Œæš‚æ—¶å¼ƒå‘ã€‚

### å†æ¬¡å°è¯•æ­å»ºmicrok8s

æ—¶é—´æ¥åˆ°å‘¨æœ«ï¼Œæˆ‘æœ‰æ—¶é—´æ¥æ¥ç€æè¿™ä¸ªé—®é¢˜ï¼Œç„¶åå°è¯•äº†æ–°çš„æ–¹å¼ï¼š**åœ¨è¿˜æ²¡å¯åŠ¨ç³»ç»Ÿæ—¶ç›´æ¥åœ¨TFå¡ä¸Šä¿®æ”¹cmdline.txtæ–‡ä»¶ï¼ŒåŠ ä¸Šcgroupå¯åŠ¨å‚æ•°**ï¼Œè¿™æ¬¡çœ‹èµ·æ¥æˆåŠŸäº†ï¼Œä½†ç”±äºæˆ‘é‡è£…äº†ç³»ç»Ÿï¼Œéœ€è¦é‡æ–°snapå®‰è£…microk8sï¼Œå¯ç”±äºå¢™çš„é—®é¢˜ï¼Œå®‰è£…è¿‡ç¨‹å¼‚å¸¸ç¼“æ…¢ï¼Œå°è¯•äº†ä¸€ä¸¤ä¸ªå°æ—¶ï¼Œä¾æ—§æ²¡æœ‰å®‰è£…æˆåŠŸã€‚è¿™åŠ ä¸Šä¸‹é¢å‡ ä¸ªåŸå› ï¼ŒåŠ¨æ‘‡äº†æˆ‘ä½¿ç”¨microk8sçš„ä¿¡å¿ƒ

- å‰ä¸€æ¬¡å³ä½¿å®‰è£…æˆåŠŸï¼Œå…¶å‘½ä»¤å“åº”æ—¶é—´è¿˜æ˜¯éå¸¸æ…¢
- microk8séƒ½è¿™æ ·ï¼Œé‚£åŸç‰ˆkubernetesè¿˜å¾—äº†ï¼Ÿ
- çœ‹æ¥ç•™ç»™æˆ‘é€‰æ‹©çš„ç©ºé—´ä¸å¤šäº†â€”â€”k3s

å†æ¬¡å¼ƒå‘ã€‚

### kubeadm+äº‘æœåŠ¡å™¨

æ°é€¢åŒåäºŒï¼Œè…¾è®¯äº‘æœ‰ä¸€å°è½»é‡åº”ç”¨æœåŠ¡å™¨2C4Gç‰ˆåªéœ€è¦74å…ƒä¸€å¹´ã€‚ç»è¿‡ä¸Šé¢ä¸¤æ¬¡åœ¨æ ‘è“æ´¾ä¸Šæ­å»ºé›†ç¾¤çš„å¤±è´¥ï¼Œæˆ‘å¼€å§‹æ€€ç–‘è‡ªå·±ï¼Œæ­å»ºkubernetesçš„ç›®çš„æ˜¯ä¸ºäº†ç ”ç©¶å®ƒï¼Œè€Œä¸æ˜¯ä¸ºäº†ç©ï¼Œåº”è¯¥ä»¥æœ€çŸ­çš„æ—¶é—´å®Œæˆå®ƒã€‚é‚£ä¹ˆå°±ç”¨kubeadmåœ¨è¿™å°æ–°è´­çš„æœåŠ¡å™¨ä¸Šæ­å»ºå®ƒå§â€”â€”å®ƒç»å¯¹ä¸ä¼šæœ‰cgroupçš„é—®é¢˜ã€‚

å¯¹æ­¤ï¼Œä¹Ÿæœ‰[å®˜æ–¹æ‰‹å†Œ](https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/install-kubeadm/)ï¼Œæ­¥éª¤çœ‹èµ·æ¥ä¸å¤æ‚ï¼Œæˆ‘åšäº†è¿™ä¹ˆäº›äº‹

#### å®‰è£…kubadm

- å…è®¸iptablesæ¡¥æ¥æµé‡

- åœ¨äº‘æœåŠ¡å™¨å®‰å…¨ç»„æ‰“å¼€æ‰€æœ‰ç«¯å£

- å®‰è£…è¿è¡Œæ—¶ï¼Œæˆ‘é€‰æ‹©äº†dockerï¼Œç›´æ¥`sudo apt install docker.io`ï¼Œå¾ˆæ–¹ä¾¿

- å®‰è£…kubeadmã€kubectlã€kubeletã€‚è¿™é‡Œéœ€è¦æ·»åŠ kubernetesçš„æºï¼Œç„¶åå®ƒè¢«å¢™äº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚

  äºæ˜¯å‚è€ƒ[è¿™ç¯‡æ–‡ç« ](https://zhuanlan.zhihu.com/p/46341911)ä½¿ç”¨ä¸­ç§‘å¤§çš„æº

  ```shell
  # æ·»åŠ ä¸­ç§‘å¤§çš„æº
  cat <<EOF > /etc/apt/sources.list.d/kubernetes.list
  deb http://mirrors.ustc.edu.cn/kubernetes/apt kubernetes-xenial main
  EOF
  
  # æ‰§è¡Œè¿™ä¸€æ­¥ä¼šæŠ¥é”™ï¼Œæç¤ºGPGkeyçš„é—®é¢˜
  sudo apt update
  
  # è¿™äº†è§£å†³é‚£ä¸ªé”™è¯¯ï¼Œå°†ä¸‹é¢çš„<publickey>æ›´æ¢ä¸ºå®é™…æŠ¥é”™çš„key
  gpg --keyserver keyserver.ubuntu.com --recv-keys <publickey>
  gpg --export --armor <publickey> | sudo apt-key add -
  
  # å†æ¬¡æ‰§è¡Œ
  sudo apt-get update
  # å®‰è£…
  sudo apt-get install -y kubelet kubeadm kubectl
  # é”å®šç‰ˆæœ¬
  sudo apt-mark hold kubelet kubeadm kubectl
  ```

- é…ç½®cgroupé©±åŠ¨ç¨‹åº

  è¿™ä¸€æ­¥æˆ‘æ˜¯æŒ‰ç…§ä¸€ä¸ªè§†é¢‘é…ç½®çš„ï¼Œä½†å…¶å®åº”è¯¥æŒ‰ç…§[å®˜ç½‘é…ç½®](https://kubernetes.io/zh/docs/tasks/administer-cluster/kubeadm/configure-cgroup-driver/)

- å…³é—­swapï¼š`sudo swapoff -a`

#### kubeadm init

ç„¶åæ‰§è¡Œä¸»èŠ‚ç‚¹çš„åˆå§‹åŒ–å·¥ä½œï¼Œè¿™é‡Œä¼šé‡åˆ°é—®é¢˜ï¼škubernetesçš„æ‰€æœ‰ç»„ä»¶ä»¥é•œåƒçš„å½¢å¼æä¾›ï¼Œæ˜¯ä»googleçš„å®¹å™¨æœåŠ¡gcræ‹‰å–çš„ï¼Œç„¶è€Œå®ƒåˆè¢«å¢™äº†ã€‚ã€‚ã€‚éœ€è¦æ›´æ¢å›½å†…æºï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ«äººæ”¾åœ¨é˜¿é‡Œäº‘ä»“åº“çš„é•œåƒï¼ŒæŒ‰ç…§å¦‚ä¸‹æ–¹å¼åš

```shell
# å…ˆæ‹‰å–
kubeadm config image pull --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers
# å†å¯åŠ¨
kubeadm init --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers
```

å¯åŠ¨æˆåŠŸåä¼šæœ‰å¦‚ä¸‹æç¤ºï¼Œå…³é”®ä¿¡æ¯æœ‰ä¸‰ç‚¹

1. åˆ›å»º~/.kube/configæ–‡ä»¶ï¼Œæ–¹ä¾¿kubectlè®¿é—®
2. éœ€è¦é©¬ä¸Šå®‰è£…ç½‘ç»œæ’ä»¶
3. å¦‚æœéœ€è¦åŠ å…¥å·¥ä½œèŠ‚ç‚¹ï¼Œä½¿ç”¨è¿™é‡ŒæŒ‡å®šçš„ç«¯ç‚¹å’Œtoken

```shell
Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

Alternatively, if you are the root user, you can run:

  export KUBECONFIG=/etc/kubernetes/admin.conf

You should now deploy a pod network to the cluster.
Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can join any number of worker nodes by running the following on each as root:

kubeadm join 10.0.20.5:6443 --token qi250a.gmbet3podjq1bcwg \
        --discovery-token-ca-cert-hash sha256:68147e1e117e54dbeb8fce34be6c83c7d7fb918c1ad2923b404c4d03f439a178
```

å¯¹äºç½‘ç»œæ’ä»¶ï¼Œå»å®ƒæç¤ºçš„é‚£ä¸ªç½‘ç«™ï¼Œè¿›å…¥æƒ³è¦çš„æ’ä»¶ä¸»é¡µï¼Œä¼šæœ‰æç¤ºä¿¡æ¯

![image-20211218165103556](https://gdz.oss-cn-shenzhen.aliyuncs.com/local/image-20211218165103556.png)

æ‰§è¡Œ`kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml`ï¼Œå®‰è£…flannelæ’ä»¶ã€‚

å†ç­‰åæ¥åˆ†é’Ÿï¼Œä¸»èŠ‚ç‚¹åº”è¯¥å°±èƒ½ç”¨äº†ï¼Œ`kubectl get ndoes`èƒ½å¤ŸæŸ¥çœ‹æ•ˆæœã€‚

```shell
ubuntu@VM-20-5-ubuntu:~$ sudo kubectl get nodes
NAME             STATUS   ROLES                  AGE     VERSION
vm-20-5-ubuntu   Ready    control-plane,master   4h23m   v1.23.1
```

#### kubeadm join

æˆ‘æœ‰å‘ç°ï¼Œåä¸ºäº‘ä¹Ÿæœ‰41å—é’±çš„1C2Gæœºå™¨å¯ä»¥ä¹°ï¼ŒåŠ ä¸Šæˆ‘åŸæ¥UCloudçš„1C2Gçš„æœºå™¨ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥æ„å»ºä¸€ä¸ªæ‹¥æœ‰ä¸‰ä¸ªä¸åŒäº‘æœåŠ¡å‚å•†èŠ‚ç‚¹çš„å¼‚æ„é›†ç¾¤ğŸ¤”ã€‚

è¦è¿™ä¹ˆåšï¼Œé¦–å…ˆè¦è§£å†³çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå¦‚ä½•é€šè¿‡å¤–ç½‘è®¿é—®ä¸Šé¢æ­å»ºçš„ä¸»èŠ‚ç‚¹ï¼Ÿç»éªŒå‘Šè¯‰æˆ‘ï¼Œæ‰¾åˆ°configé…ç½®æ–‡ä»¶ï¼Œå°†é›†ç¾¤åœ°å€æ”¹ä¸ºè¯¥äº‘æœåŠ¡å™¨çš„å…¬ç½‘åœ°å€ç„¶åæ”¾åœ¨æœ¬åœ°çš„`~/.kube/config`å°±è¡Œäº†ï¼Œæˆ‘ç¡®å®è¿™ä¹ˆåšäº†ï¼Œä½†ä½¿ç”¨kubectlè¿æ¥æ—¶è¿˜æ˜¯æŠ¥äº†ä¸ªé”™ï¼šæç¤ºæœåŠ¡å™¨è¯ä¹¦ä¸å…è®¸å¤–ç½‘è®¿é—®æ¥æºã€‚å¯¹æ­¤çš„è§£å†³åŠæ³•å‚è€ƒ[è¿™ç¯‡æ–‡ç« ](https://blog.csdn.net/yy_diego/article/details/109362884)ï¼Œæ€è·¯æ˜¯é‡æ–°ç”ŸæˆAPI Serverçš„è¯ä¹¦ã€‚ç®—æ˜¯è§£å†³äº†å¤–ç½‘è®¿é—®çš„é—®é¢˜ã€‚

ç†æ‰€å½“ç„¶åœ°ï¼Œæˆ‘åœ¨kubeadm joinçš„å‘½ä»¤ä¸­ä¹ŸæŠŠå†…ç½‘åœ°å€æ›¿æ¢ä¸ºå…¬ç½‘åœ°å€ã€‚ä½†æœ€ç»ˆè¿˜æ˜¯æŠ¥é”™äº†ï¼šæç¤ºkubeadmin-configè¿™ä¸ªconfigmapæ‰¾ä¸åˆ°ï¼Œè€Œå®ƒå±…ç„¶ä½¿ç”¨äº†å†…ç½‘åœ°å€å»è®¿é—®ğŸ¤”ã€‚è¿™å°±æœ‰ç‚¹éº»çƒ¦äº†ï¼Œç½‘ä¸Šæœç´¢äº†ä¸€ä¸‹ï¼Œ**å¤–ç½‘é›†ç¾¤æ­å»ºèµ·æ¥ä¼šæ¶‰åŠåˆ°å¾ˆå¤šç½‘ç»œé—®é¢˜ï¼Œå±å®æ²¡å¿…è¦å»ç ”ç©¶**ã€‚æ€§ä»·æ¯”å¤ªä½ã€‚

ä¸è¡Œï¼Œå·²ç»åœ¨è¿™ä¸ªä¸Šé¢è€—è´¹å¤ªå¤šæ—¶é—´äº†ï¼Œå°±ç”¨è¿™ä¸ªä¸»èŠ‚ç‚¹å§ã€‚ä¹Ÿç®—æœ‰ä¸€äº›æˆæœ

### æ­å»ºk3s

æ ‘è“æ´¾çš„äº‹æƒ…ï¼Œè¿˜æ˜¯æœ‰ç‚¹ä¸ç”˜å¿ƒçš„ï¼Œæ˜æ˜å›°æ‰°äº†å¥½é•¿ä¸€æ®µæ—¶é—´çš„cgroupè§£å†³äº†ï¼Œå´ä¸èƒ½å®‰è£…é›†ç¾¤ã€‚ã€‚ã€‚åˆ’ä¸æ¥å‘€ã€‚å¥½æ­¹ï¼Œæˆ‘å¾—å°è¯•ä¸€ä¸‹k3så‘€ã€‚

äºæ˜¯ï¼Œæˆ‘å‚è€ƒäº†[å®˜æ–¹æ–‡æ¡£](https://docs.rancher.cn/docs/k3s/installation/install-options/_index)å’Œ[è¿™ç¯‡æ–‡ç« ](https://www.yuweizhan.cn/articles/2020/07/18/1595040455803.html)ã€‚è¿™é‡Œçš„å…³é”®æ˜¯ä½¿ç”¨å®˜æ–¹æä¾›çš„å›½å†…åŠ é€Ÿåœ°å€ï¼Œç”¨å›½å¤–åœ°å€å¾ˆå¯èƒ½ä¼šå®‰è£…å¤±è´¥ã€‚

ä¸»èŠ‚ç‚¹

```shell
# ä»€ä¹ˆéƒ½ä¸è®¾ç½®ï¼Œç›´æ¥å®‰è£…ï¼Œé»˜è®¤æ˜¯ä½œä¸ºä¸»èŠ‚ç‚¹çš„
curl -sfL http://rancher-mirror.cnrancher.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn sh -
```

å·¥ä½œèŠ‚ç‚¹

```shell
# åœ¨ä¸»èŠ‚ç‚¹ä¸Šæ‰§è¡Œ:è·å–ä¸»èŠ‚ç‚¹çš„token
cat /var/lib/rancher/k3s/server/node-token

# åœ¨ä»èŠ‚ç‚¹ä¸Šæ‰§è¡Œ
export K3S_TOKEN=<ä¸Šé¢å¾—åˆ°çš„token>
export K3S_URL=https://<master_ip>:6443
curl -sfL http://rancher-mirror.cnrancher.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn sh -
```

åœ¨åˆ›å»ºå·¥ä½œèŠ‚ç‚¹æ—¶ï¼Œé‡åˆ°è¿‡ä»èŠ‚ç‚¹èµ·ä¸æ¥çš„é—®é¢˜ï¼Œæç¤ºpasswdä¸åŒ¹é…ï¼Œå‚ç…§[è¿™ç¯‡æ–‡ç« ](https://cloud.tencent.com/developer/article/1594895)è§£å†³äº†ã€‚

ç„¶åï¼Œå°±æ­å»ºå®Œæˆäº†ï¼Œæ­¤æ—¶åœ¨ä¸»èŠ‚ç‚¹ä¸Šå¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªèŠ‚ç‚¹

```shell
root@ubuntu:/home/ubuntu# kubectl get nodes
NAME             STATUS   ROLES                  AGE    VERSION
ubuntu           Ready    control-plane,master   3h8m   v1.21.7+k3s1
raspberry-4c2g   Ready    <none>                 70m    v1.21.7+k3s1
```

## æ€»ç»“

è¿™ä¸‰ç§kubernetesçš„æ­å»ºæ–¹å¼ï¼Œå…¶å®éƒ½ä¸å¤æ‚ï¼Œè¢«å¡ä½çš„åŸå› éƒ½æ˜¯å¢™ï¼Œå±å®è›‹ç–¼ã€‚è¿™å…¶ä¸­ï¼ŒK3sæä¾›çš„æ”¯æŒæœ€ä¸ºå‹å¥½ï¼Œä¸ä½†æœ‰ä¸­æ–‡èµ„æ–™ï¼Œè¿˜æœ‰å®˜æ–¹å›½å†…åŠ é€Ÿåœ°å€ï¼Œå®Œå…¨ä¸ä¼šæœ‰å…¶å®ƒä¸¤ç§æ–¹å¼çš„é—®é¢˜ã€‚microk8så¦‚æœåœ¨ç½‘ç»œç¯å¢ƒå…è®¸çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥ä¹ŸæŒºç®€å•çš„ï¼Œå®ƒç±»ä¼¼kubeadmï¼Œä¹Ÿæ˜¯é€šè¿‡initã€joinè¿™æ ·ç®€å•çš„å‘½ä»¤å»æ„å»ºé›†ç¾¤ï¼Œå¯æƒœçš„æ˜¯ä¸æ˜åŸå› å¯¼è‡´åœ¨æˆ‘çš„ç¯å¢ƒä¸­ç”¨èµ·æ¥å¡å¡çš„ã€‚kubeadmç›¸å¯¹è€Œè¨€æ˜¯æœ€å¤æ‚çš„ï¼Œkubectlç­‰è½¯ä»¶åŒ…çš„è½¯ä»¶æºéœ€è¦æ›´æ¢ï¼Œé•œåƒæºä¹Ÿè¦æ›´æ¢ã€‚

ä¸è¿‡ä¸€ç•ªæŠ˜è…¾ä¸‹æ¥ï¼Œæˆ‘å¥½æ­¹æ˜¯æ‹¥æœ‰ä¸¤ä¸ªkubernetesé›†ç¾¤ï¼Œä¸€ä¸ªæ‹¥æœ‰ä¸¤ä¸ªèŠ‚ç‚¹çš„æ ‘è“æ´¾é›†ç¾¤å’Œä¸€ä¸ªæ‹¥æœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„åœ¨è…¾è®¯äº‘ä¸Šçš„é›†ç¾¤ï¼Œå­¦ä¹ ç”¨æ˜¯å¤Ÿäº†ã€‚ä½†ä¸ºä»€ä¹ˆè¿™ç¯‡æ–‡ç« æ˜¯ï¼ˆä¸Šï¼‰å‘¢ï¼Ÿå› ä¸ºå…¶å®ƒä¸¤å°å¤–ç½‘æœåŠ¡å™¨ï¼Œæˆ‘è¿˜æƒ³è¦æŠ˜è…¾ä¸€ä¸‹ï¼Œä¸è¿‡ä¸æ˜¯æœ€è¿‘ï¼Œè€Œæ˜¯ç­‰æˆ‘kubernetesè¶³å¤Ÿç†Ÿç»ƒä¹‹åã€‚

æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬é‡åˆ°çš„é—®é¢˜

- æ ‘è“æ´¾cgroupå¼€å¯å¤±è´¥ï¼šåœ¨å¯åŠ¨ç³»ç»Ÿä¹‹å‰ä¿®æ”¹cmdline.txt
- kubernetesçš„aptæºæ— æ³•è®¿é—®ï¼šæ›´æ¢ä¸­ç§‘å¤§æˆ–é˜¿é‡Œäº‘çš„æº
- gcré•œåƒä»“åº“æ— æ³•è®¿é—®ï¼šæ›´æ¢é˜¿é‡Œäº‘çš„é•œåƒä»“åº“
- k3så®‰è£…è„šæœ¬æ‰§è¡Œç¼“æ…¢ï¼šä½¿ç”¨å®˜æ–¹æä¾›çš„å›½å†…ä¸“ç”¨å®‰è£…è„šæœ¬
- k3sä»èŠ‚ç‚¹å¯åŠ¨å¤±è´¥ï¼šæ‰‹åŠ¨å°†ä¸»èŠ‚ç‚¹çš„/etc/rancher/passwdå¤åˆ¶åˆ°ä»èŠ‚ç‚¹

æ€»ç»“ä¸€ä¸‹è¿™æ¬¡çš„æ•™è®­ï¼šæŠ˜è…¾ä¸¤ä¸‰å¤©æ•´è¿™ä¹ˆä¸ªç©æ„å„¿æ˜¯å¾ˆåˆ’ä¸æ¥çš„ï¼Œæœ€å®Œç¾çš„æ–¹å¼ï¼Œæ˜¯åœ¨ä¸€ä¸ªäº‘æœåŠ¡å‚å®¶è´­ä¹°ä¸¤ä¸‰å°ä¸­é…çš„æœºå™¨ï¼Œä»¥æ­¤æ­å»ºï¼Œè¿™æ ·æ—¢ä¸ä¼šé‡åˆ°cgroupé—®é¢˜ï¼Œä¹Ÿä¸ä¼šé‡åˆ°å…¬ç½‘è®¿é—®é—®é¢˜ï¼Œè¿˜æ˜¯æ ‡å‡†çš„kubernetesç¯å¢ƒã€‚è€Œä¸”æˆ‘ä»¬å¯ä»¥åªä¹°ä¸€ä¸¤ä¸ªæœˆï¼Œä¸ç”¨äº†å†é‡Šæ”¾æ‰ï¼Œä¸ä¼šèŠ±å¤šå°‘é’±ã€‚é•¿è¿œçœ‹æ˜¯æˆæœ¬æœ€ä½çš„ä¸€ç§æ–¹å¼ã€‚æ¯•ç«Ÿï¼Œä¸‰å°æ ‘è“æ´¾çš„ä»·æ ¼ï¼Œä¹Ÿä¸Šåƒå…ƒäº†ï¼Œå¦‚æœå†åŠ ä¸Šäº¤æ¢æœºå’Œé…ä»¶ï¼Œåˆ™æ›´è´µã€‚æ­å»ºå‡ºæ¥çš„é›†ç¾¤ï¼Œè¿˜ä¸æ˜¯å®˜æ–¹åŸç‰ˆğŸ¤”ã€‚
